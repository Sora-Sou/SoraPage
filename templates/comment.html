<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/libs/bootstrap-4.5.0/bootstrap.min.css">
    <script src="../static/libs/jquery-3.5.1.min.js"></script>
    <script src="../static/libs/bootstrap-4.5.0/bootstrap.bundle.min.js"></script>
    <title>Document</title>
    <style>
        #comment_container {
            padding: 1px;
        }

        #comment_hr {
            margin: 1.5rem 0 0.5rem 0;
        }

        textarea {
            padding: 14px;
            height: 5rem;
            width: 100%;
            resize: none;
            border: none;
        }

        textarea:focus {
            outline: none;
        }

        .comment_input {
            width: 100%;
            padding: 0.5rem 14px;
            border: none;
            border-bottom: #6c757d 1px dashed;
        }

        .comment_input:focus {
            outline: none;
            border-bottom: #007bff 1px dashed;
        }

        #submit_flex {
            padding: 1rem;
            display: flex;
            justify-content: flex-end;
        }

        .comment_row {
            display: flex;
            justify-content: space-between;
        }

        .media {
            margin-top: 1.5rem;
        }

        #reply_info {
            display: none;
        }

        .reply_cancel {
            display: flex;
            justify-content: flex-end;
        }
    </style>
    <script>
        $(document).ready(function () {
            $('.reply_btn').click(function () {
                var reply_name = $(this).parent().siblings("h5").text()
                var reply_comment = $(this).parent().siblings("p").text()
                $('#reply_name').text(reply_name)
                $('#reply_comment').text(reply_comment)
                $('#reply_info').fadeIn()
                $('#replyTo').val('name=' + reply_name + '&comment=' + reply_comment)
            })
            $('.reply_cancel_btn').click(function () {
                $('#reply_info').fadeOut()
                $('#replyTo').val('')
            })
        })
    </script>
</head>

<body>
    <div class="container">
        <hr id="comment_hr">
        <div class="p-3 my-2 bg-primary text-white rounded" id="reply_info">
            <p>你将回复<span id="reply_name"></span>的评论</p>
            <p id="reply_comment"></p>
            <div class="reply_cancel">
                <button class="btn btn-light reply_cancel_btn">取消回复</button>
            </div>
        </div>
        <div id="comment_container" class="border border-primary rounded">
            <form method="post" action="comment">
                <div class="row">
                    <div class="col-12 col-md-6 pr-md-1">
                        <input type="text" name="name" placeholder="昵称" class="comment_input">
                    </div>
                    <div class="col-12 col-md-6 pl-md-0">
                        <input type="email" name="email" placeholder="邮箱" class="comment_input">
                    </div>
                </div>
                <textarea name="comment" placeholder="Comment Here~"></textarea>
                <div id="submit_flex">
                    <input type="submit" value="评论" class="btn btn-outline-primary">
                </div>
                <input type="hidden" id="replyTo">
            </form>
        </div>
    </div>
    <div class="container mt-3">
        <div class="border border-primary rounded px-2">
            <ul class="list-unstyled">
                {% for i in range(root|length) %}
                    <li class="media-body">
                        <img src="avatar.png" height="64px">
                        <div class="media-body">
                            <h5>{{ root[i]['name'] }}</h5>
                            <div class="comment_row">
                                <div class="comment_time text-muted">{{ root[i]['time'] }}</div>
                                <button class="btn btn-link reply_btn">回复</button>
                            </div>
                            <p>{{ root[i]['comment'] }}</p>
                            {% for k in range(reply|length) %}
                                {% if reply[k]['root']==root[i]['id'] %}
                                    <div class="media">
                                        <img src="avatar.png" height="64px">
                                        <div class="media-body">
                                            <h5>{{ reply[k]['name'] }}</h5>
                                            <div class="comment_row">
                                                <div class="comment_time text-muted">{{ reply[k]['time'] }}</div>
                                                <button class="btn btn-link reply_btn">回复</button>
                                            </div>
                                            <p>{{ reply[k]['comment'] }}</p>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </li>
                {% endfor %}
                {#                <li class="media">#}
                {#                    <img src="avatar.png" height="64px">#}
                {#                    <div class="media-body">#}
                {#                        <h5>Sora</h5>#}
                {#                        <div class="comment_row">#}
                {#                            <div class="comment_time text-muted">2020-7-10</div>#}
                {#                            <button class="btn btn-link reply_btn">回复</button>#}
                {#                        </div>#}
                {#                        <p>SoraPage Project</p>#}
                {#                        <div class="media">#}
                {#                            <img src="avatar.png" height="64px">#}
                {#                            <div class="media-body">#}
                {#                                <h5>Media heading</h5>#}
                {#                                <p>Media Content</p>#}
                {#                            </div>#}
                {#                        </div>#}
                {#                        <div class="media">#}
                {#                            <img src="avatar.png" height="64px">#}
                {#                            <div class="media-body">#}
                {#                                <h5>Media heading</h5>#}
                {#                                <p>Media Content</p>#}
                {#                            </div>#}
                {#                        </div>#}
                {#                    </div>#}
                {#                </li>#}
                {#                <li class="media">#}
                {#                    <img src="avatar.png" height="64px">#}
                {#                    <div class="media-body">#}
                {#                        <h5>media header</h5>#}
                {#                        <p>media content</p>#}
                {#                    </div>#}
                {#                </li>#}
            </ul>
        </div>
    </div>
</body>

</html>