<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../../../wholeSite/icon.png" type="image/x-icon">
    <title>SoraPage</title>
    <link type="text/css" rel="stylesheet" href="../../../tutorial/tutorialHeader.css" />
    <link type="text/css" rel="stylesheet" href="../../../wholeSite/prism.css" />
    <script src="../../../wholeSite/prism.js"></script>
    <style>
        #allContents {
            margin-top: 36px;
        }

        #passage {
            line-height: 2;
            color: rgb(50, 50, 50);
        }

        .backgroundColor_gray {
            padding: 0 15% 0 15%;
            background-color: rgb(240, 240, 240);
        }

        .backgroundColor_white {
            padding: 0 15% 0 15%;
        }

        ol,
        ul {
            margin-inline-start: 2rem;
        }

        ol ul {
            list-style-type: disc;
        }

        #comments {
            padding: 3% 15% 0 15%;
        }
    </style>
</head>

<body>
    <header>
        <span id="headerWebname" style="margin-top: 0;">
            <a href="../../../homepage/homepage.html">SoraPage</a>
        </span>
        <div id="headerTitle">WebHook</div>
    </header>

    <div id="allContents">
        <div id="passage">

            <div class="backgroundColor_gray">
                <h1 style="text-align: center;">宝塔面板WebHook设置</h1>
                <h4 style="text-align: center;">最后更新：2020年1月30日16:13</h4>
                <p>通过webhook可以实现往github进行push操作时，在设置了webhook的服务器上就能自动拉取最新的代码，省去了再次部署的麻烦。webhook的原理大同小异，不仅仅局限于宝塔面板。</p>
            </div>

            <div class="backgroundColor_white">
                <h2>宝塔面板添加webhook</h2>
                <ol>
                    <li>
                        <h4>宝塔面板设置webhook</h4>
                        <p>在宝塔面板的软件商店中搜索webhook，下载安装</p>
                        <img src="BT_1.png" width="100%">
                    </li>
                    <li>
                        <h4>重点：配置webhook的shell脚本</h4>
                        <p>在面板首页的webhook中添加hook</p>
                        <img src=BT_2.png width="100%">
                        <p>名称可以随便填，执行脚本栏内填入下方代码,强调下这是Linux系统shell脚本，不懂的语法可以去Google</p>
                        <pre class="language-shell line-numbers">
<code>#!/bin/bash
   
echo ""
#输出当前时间
date --date='0 days ago' "+%Y-%m-%d %H:%M:%S"
echo "Start"
#git项目路径
gitPath="/www/wwwroot/SoraPage"
#git 网址
gitHttp="https://github.com/Sora-Sou/SoraPage.git"
#判断项目路径是否存在
if [ -d "$gitPath" ]; then
        cd $gitPath
        echo "拉取最新的项目文件"
        sudo git fetch --all && git reset --hard origin/master && git pull        
        echo "设置目录权限"
        sudo chown -R www:www $gitPath
        echo "End"
        date --date='0 days ago' "+%Y-%m-%d %H:%M:%S"
        exit
fi
</code></pre>
                        <p><strong>上述脚本需要自定义的地方</strong></p>
                        <ul>
                            <li>第8行：gitPath换成你网站的根目录（或者代码存放文件夹）</li>
                            <li>第10行：gitHTTP换成你github仓库的HTTPS克隆链接（默认的克隆链接是SSH，注意切换）</li>
                            <li>第15行：git的命令可以自己写，这里给出的命令是从github拉取并强制覆盖（会丢失你在服务器上作出的更改）</li>
                        </ul>
                    </li>
                    <li>
                        <h4>获取webhook密钥</h4>
                        <p>密钥是从“http”一直到“param=aaa”这一段的，复制。</p>
                        <img src="BT_3.png" width="70%">
                    </li>
                </ol>
            </div>

            <div class="backgroundColor_gray">
                <h2>GitHub添加webhook</h2>
                <ol>
                    <li>
                        <h4>在repo的设定里找到WebHooks，点Add webhook</h4>
                        <img src="github_1.png" width="100%">
                    </li>
                    <li>
                        <h4>把复制的密钥填入Payload URL中，Add webhook！</h4>
                        <img src="github_2.png" width="100%">
                    </li>
                    <li>可以push试一试，应该是没问题了。</li>
                </ol>
            </div>

        </div>

        <div id="comments">
            <!--评论系统-->
            <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
            <div id="vcomments"></div>
            <script>
                new Valine({
                    el: '#vcomments',
                    appId: 'cCE8pXKvbUCFj5JuT7hic3q6-gzGzoHsz',
                    appKey: 'mgKE70GqsKmROxG4KalTmgVF',
                    visitor: true,
                    meta: ['nick', 'mail']
                })
            </script>
            <script src="https://upcdn.b0.upaiyun.com/libs/jquery/jquery-2.0.2.min.js"></script>
            <script>
                if (window.location.hash) {
                    var checkExist = setInterval(function () {
                        if ($(window.location.hash).length) {
                            $('html, body').animate({ scrollTop: $(window.location.hash).offset().top - 90 }, 1000);
                            clearInterval(checkExist);
                        }
                    }, 100);
                }
            </script>
            <!--评论系统完-->
        </div>
    </div>
</body>

</html>