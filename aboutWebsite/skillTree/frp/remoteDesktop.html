<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <link rel="icon" href="/wholeSite/img/icon.png" type="image/x-icon">
    <link type="text/css" rel="stylesheet" href="/wholeSite/css/fixedHeader.css" />
    <link type="text/css" rel="stylesheet" href="/wholeSite/css/H5_stripeLayout.css" />
    <script src="/wholeSite/js/stripeLayout.js"></script>
    <title>frp远程桌面设置教程</title>
    <style>
        .explanation {
            margin: 1rem 0 1rem 1rem;
            padding-left: 1rem;
            border-left: gray solid 4px;
            font-style: oblique;
        }
    </style>
    <script src="/wholeSite/js/prism.js"></script>
    <link type="text/css" rel="stylesheet" href="/wholeSite/css/prism.css">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https: //www.googletagmanager.com/gtag/js?id=UA-156500969-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-156500969-1');
    </script>
</head>

<body>
    <header>
        <span id="headerWebname" style="margin-top: 0;">
            <a href="/homepage/homepage.html">SoraPage</a>
        </span>
        <div id="headerTitle">frp远程桌面</div>
    </header>

    <main>
        <article id="passage">

            <section id="title">
                <h1>frp远程桌面设置教程</h1>
                <p id="lastUpdate"><strong>最后更新：<time>2020年4月22日</time></strong></p>
                <p>frp是一款功能强大的内网穿透工具，在gayhub上已经被star了超过35K次，这篇教程挑其中较为常见的远程桌面的功能来说说。</p>
                <p>说起远程桌面，可能teamviewer算的上业界的大哥了，但是我个人用过之后觉得延迟太高了不好使，并无多加研究后遂弃。</p>
                <p>之后自从回坑Galgame，迫切地需要一款可以在床上用iPad推游戏的软件，也试过steam的流式功能，发现对Galgame并不友好，这个需求就一直被搁置下来。</p>
                <p>最近刷逼乎时了解到有frp这一项技术，简单尝试后，着实让我喜出望外。遂脑补开发出如下几种姿势：</p>
                <ul>
                    <li>上水课带个iPad远程操控电脑，VSCode实时码代码，并且还能调试</li>
                    <li>半夜在床上拿iPad推Galgame（这才是最香的用处，手动滑稽）</li>
                    <li>笔记本连接台式机，两个桌面同时耍，笔记本上指使台式干一些脏重活后实时传回处理结果</li>
                </ul>
            </section>

            <section id="mechanism">
                <h2>原理：端口映射</h2>
                <p>总的来说，就是把内网下的某一端口映射到公网下的某一端口。在远程桌面这一功能下，是将家里电脑的3389端口（windows默认远程桌面端口）映射至公网上的任意端口。然后通过公网上的这一端口访问家里电脑的远程桌面服务。
                </p>
                <img src="rd_1.png" width="60%" style="margin: 1%;">
                <p>具体的原理会在下面的设置中一步步地讲解，但是上面这张图是通讯原理的核心。</p>
            </section>

            <section id="serverSetting">
                <h2>服务端设置</h2>
                <h3>Step-1：上传frp文件</h3>
                <p>在<a href="https://github.com/fatedier/frp/releases"
                        target="_blank">gayhub</a>的项目最新release中找到对应你服务器的frp版本下载。一般而言，你的VPS都是基于amd64架构的，下载这个版本的就行。</p>
                <img src="rd_2.png" width="100%">
                <p>下载到本地后，解压，得到如下文件</p>
                <img src="rd_3.png" width="100%">
                <p>无需改动任何文件，原封不动地将<strong>整个文件夹</strong>上传（通过FTP软件）到服务器上任一位置，建议上传到root目录下</p>
                <div class="explanation">
                    <p>原理：</p>
                    <p>可以打开frps.ini文件瞅一眼，会发现里面只有一行设置 bind_port=7000</p>
                    <p>这个设置说明，中转服务器通过7000端口与被操控的PC进行通讯，即如下图所示</p>
                    <img src="rd_4.png" width="70%" style="margin: 1%;">
                    <p>修改这个 bind_port 参数值可以改变服务端与被操控PC的通讯端口号</p>
                </div>
                <h3>Step-2：启动服务端frp</h3>
                <p>SSH连上服务器，通过cd命令进入frp文件夹内</p>
                <pre class="language-shell line-numbers"><code>cd frp_0.32.1_linux_amd64</code></pre>
                <p>输入以下命令以启动服务器端的frp，nohup命令可以让进程在后台运行</p>
                <pre class="language-shell line-numbers"><code>nohup ./frps -c ./frps.ini &</code></pre>
                <p>服务器端的frp运行日志在frp文件夹里的nohup.out中可以查看</p>
                <div class="explanation">
                    <p>原理：</p>
                    <p>打开nohup.out会发现如下的输入信息（可以直接在FTP软件中打开该文件）</p>
                    <p>2020/04/22 18:46:50 [1;34m[I] [service.go:157] frps tcp listen on 0.0.0.0:7000[0m</p>
                    <p>2020/04/22 18:46:50 [1;34m[I] [root.go:209] start frps success[0m</p>
                    <p>说明frp在服务器上成功运行，并且正在监听7000端口</p>
                </div>
            </section>

            <section id="clientSetting">
                <h2>客户端设置</h2>
                <h3>Step-1：下载客户端frp</h3>
                <p>同样在之前的gayhub release页面下载你电脑对应的版本，对于Windows 64位的小伙伴下载windows amd64的版本即可</p>
                <img src="rd_5.png" width="100%">
                <h3>Step-2：修改客户端配置文件</h3>
                <p>下载后解压，打开frpc.ini文件，改成如下代码</p>
                <pre class="language-none line-numbers"><code>[common]
server_addr = 你服务器的ip地址
server_port = 7000
                    
[rdp]
type = tcp
local_ip = 0.0.0.0
local_port = 3389
remote_port = 随意填（建议1000-65535中的某一个）</code></pre>
                <p>如果你没有改动服务器端的配置文件，那么sever_port就填7000，如果改动了的话，这个参数值就必须和服务器端的bind_port一致</p>
                <div class="explanation">
                    <p>原理：</p>
                    <ul>
                        <li>[common]下面的两个参数告诉客户端的frp你服务器的通讯地址，由于之前服务器端的frp是监听的7000端口，所以在客户端要将数据发送到服务器的7000端口</li>
                        <li>rdp是 Remote Desktop Protocol 的缩写，但其本质还是tcp协议</li>
                        <li>local_port一般不能更改，在windows上默认的是通过3389端口开启远程桌面服务的</li>
                        <li>remote_port十分重要，在下文再进行讲解</li>
                    </ul>
                </div>
                <h3>Step-3：服务器端开放remote_port设置的端口</h3>
                <p>在上一步设置的remote_port，需要在服务器端把这个端口开放。一般服务器为了安全考虑只会开放部分端口，需要我们手动开启额外需要的端口。</p>
                <p>一般而言服务器有两层防火墙，一层在服务器提供商那里,另一层是linux的防火墙（貌似只有centos 7的系统才有）</p>
                <p>这个步骤请自行Google如何在服务器上开放指定端口，不再啰嗦。</p>
                <h3>Step-4：打开Windows的远程桌面服务</h3>
                <p>win10家庭版是用不了这个功能的，请升级为win10专业版</p>
                <img src="rd_6.jpg" width="100%">
                <h3>Step-5：启动客户端frp</h3>
                <p>操作和服务端的没什么大差别，打开powershell（或者cmd），cd到frp的目录下（路径名注意要改成自己的）</p>
                <pre class="language-shell line-numbers"><code>cd E:\frp\frp_0.32.1_windows_amd64</code></pre>
                <p>然后启动frp</p>
                <pre class="language-shell line-numbers"><code>.\frpc.exe -c frpc.ini</code></pre>
                <p>启动成功后,不要关闭powershell窗口，保持让其后台运行</p>
            </section>

            <section id="connect">
                <h2>远程连接</h2>
                <h3>Step-1：下载远程连接APP</h3>
                <p>对于用PC远程控制PC的，只需要用windows自带的远程连接工具即可：右键左下角田牌标志，打开搜索，搜索远程连接，远程桌面连接就是</p>
                <p>对于用手机控制PC的，使用微软开发的RD Client这个APP即可，AppStore里搜索下载即可。</p>
                <h3>Step-2：连接</h3>
                <p>以iOS上的RD Client为例，进入APP，右上角加号点击添加电脑，</p>
                <img src="rd_7.png" width="40%">
                <p>注意电脑名称那一栏，正确的格式是ip:port的形式，这里的port就是在客户端配置文件frpc.ini里设置的remote_port</p>
                <br>
                <p>到这里就应该可以愉快地使用了，基础部分到此为止，下面开始讲一些进阶的用法</p>
            </section>

            <article id="comment">
                <!--评论系统-->
                <!-- Valine -->
                <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
                <div id="vcomments"></div>
                <script>
                    new Valine({
                        el: '#vcomments',
                        appId: 'cCE8pXKvbUCFj5JuT7hic3q6-gzGzoHsz',
                        appKey: 'mgKE70GqsKmROxG4KalTmgVF',
                        visitor: true,
                        meta: ['nick', 'mail'],
                        placeholder: "Comment Here~"
                    })
                </script>
                <!-- 邮件链接跳转 -->
                <script>
                    if (window.location.hash) {
                        var checkExist = setInterval(function () {
                            if ($(window.location.hash).length) {
                                $('html, body').animate({ scrollTop: $(window.location.hash).offset().top - 90 }, 1000);
                                clearInterval(checkExist);
                            }
                        }, 100);
                    }
                </script>
                <!-- 魔改 -->
                <script src='/wholeSite/js/valineModify.js'></script>
                <style>
                    .vtime,
                    ::placeholder {
                        color: rgb(90, 90, 90) !important;
                    }

                    .vsubmit:disabled {
                        color: rgb(170, 170, 170);
                    }

                    .vquote {
                        border-left: none !important;
                    }
                </style>
                <!--评论系统完-->
            </article>

        </article>
    </main>
</body>

</html>